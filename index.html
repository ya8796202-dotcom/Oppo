<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Windows Pro Web Simulator</title>
<meta name="theme-color" content="#2563eb" />
<style>
  :root{
    --bg:#0b1220; --text:#e6eaf3; --muted:#b7c0d6; --panel:#121a2b; --accent:#2563eb;
    --border:#1f2940; --shadow:0 24px 60px rgba(0,0,0,.45);
    --win:#0f172a; --winHeader:#0b1220; --task:#0c1322; --hover:rgba(255,255,255,.08);
    --ok:#22c55e; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#000;color:var(--text);font-family:Segoe UI,system-ui,-apple-system,Roboto,"Noto Kufi Arabic",sans-serif}
  .desktop{
    position:relative; width:100vw; height:100vh; overflow:hidden;
    background: radial-gradient(1200px 800px at 20% 10%, #172554 0%, #0ea5e9 35%, #0f172a 85%);
  }
  .desktop.theme-1{background: radial-gradient(1400px 900px at 80% 20%, #1e293b 0%, #22c55e 40%, #0f172a 90%)}
  .desktop.theme-2{background: radial-gradient(1200px 800px at 20% 80%, #1e293b 0%, #a855f7 40%, #0f172a 90%)}

  /* icons grid */
  .icons{ position:absolute; inset:64px 0 64px; padding:16px; display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; }
  .icon{
    display:flex; flex-direction:column; align-items:center; gap:8px; padding:10px; border-radius:12px; cursor:pointer; user-select:none;
    background:transparent; transition:.12s; color:var(--text);
  }
  .icon:hover{ background:var(--hover) }
  .icon .glyph{
    width:56px; height:56px; border-radius:12px; display:grid; place-items:center; font-size:26px; font-weight:700;
    background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:#fff; box-shadow: inset 0 -10px 18px rgba(0,0,0,.25), 0 8px 18px rgba(0,0,0,.35);
  }
  .icon .label{ font-size:12px; text-align:center; max-width:120px; }

  /* taskbar */
  .taskbar{
    position:absolute; left:0; right:0; bottom:0; height:54px; background:var(--task); border-top:1px solid var(--border);
    display:flex; align-items:center; gap:8px; padding:0 10px; box-shadow:var(--shadow); backdrop-filter:saturate(130%) blur(8px);
  }
  .start-btn{ display:flex; align-items:center; gap:8px; background:transparent; color:#fff; border:0; cursor:pointer; padding:8px 12px; border-radius:12px; }
  .start-btn:hover{ background:var(--hover) }
  .start-dot{ width:24px; height:24px; border-radius:6px; background:linear-gradient(135deg,#22c55e,#16a34a); display:inline-block }
  .tasks{ flex:1; display:flex; gap:8px; align-items:center; overflow-x:auto; padding:6px 0 }
  .task{ min-width:140px; max-width:250px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.06); color:#fff; cursor:pointer; border:1px solid var(--border); display:flex; justify-content:space-between; }
  .task.active{ outline:2px solid var(--accent) }
  .sys{ display:flex; align-items:center; gap:10px; color:var(--muted); }
  .clock{ font-weight:600 }

  /* start menu */
  .start{
    position:absolute; left:10px; bottom:64px; width:420px; max-height:60vh; background:var(--panel);
    border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); display:none; z-index:1000;
  }
  .start.show{ display:block }
  .start .search{ padding:8px; border-bottom:1px solid var(--border) }
  .start input{ width:100%; padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:#0a1020; color:#fff }
  .start .apps{ padding:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px }
  .start .app{ display:flex; align-items:center; gap:8px; padding:8px; border-radius:10px; background:rgba(255,255,255,.06); cursor:pointer }
  .start .app:hover{ background:rgba(255,255,255,.12) }

  /* window */
  .win{
    position:absolute; top:120px; left:160px; width:760px; height:480px; background:var(--win); border:1px solid var(--border);
    border-radius:12px; box-shadow:var(--shadow); display:flex; flex-direction:column; overflow:hidden;
  }
  .win.hidden{ display:none }
  .win-header{
    height:42px; background:var(--winHeader); border-bottom:1px solid var(--border);
    display:flex; align-items:center; justify-content:space-between; padding:0 8px; cursor:move;
  }
  .win-title{ display:flex; align-items:center; gap:8px; font-weight:600 }
  .win-actions{ display:flex; gap:6px }
  .btn{ border:0; padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.08); color:#fff; cursor:pointer }
  .btn:hover{ background:rgba(255,255,255,.16) }
  .win-body{ flex:1; padding:10px; overflow:auto; color:var(--muted) }
  .resize{ position:absolute; right:0; bottom:0; width:14px; height:14px; cursor:nwse-resize; background:linear-gradient(135deg,transparent 50%, rgba(255,255,255,.2) 50%) }

  /* context menu */
  .ctx{ position:absolute; background:var(--panel); border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow); display:none; z-index:2000; min-width:200px; }
  .ctx.show{ display:block }
  .ctx .item{ padding:8px 10px; cursor:pointer }
  .ctx .item:hover{ background:rgba(255,255,255,.08) }

  /* notifications */
  .toast{
    position:absolute; right:16px; bottom:70px; min-width:260px; max-width:360px;
    background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); display:none; z-index:1500;
    padding:10px; color:var(--text)
  }
  .toast.show{ display:block }

  /* app styles */
  .grid2{ display:grid; grid-template-columns:220px 1fr; gap:10px; height:100% }
  .side{ border-right:1px solid var(--border); padding-right:10px }
  .item{ padding:6px 8px; border-radius:8px; cursor:pointer }
  .item:hover{ background:rgba(255,255,255,.06) }
  .files{ display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:10px }
  .file{ border:1px solid var(--border); border-radius:10px; padding:10px; background:rgba(255,255,255,.05) }

  .editor{ width:100%; height:100%; }
  .editor textarea{ width:100%; height:100%; padding:10px; border:1px solid var(--border); border-radius:10px; background:#0a1020; color:#fff }

  .browser-bar{ display:flex; gap:8px; margin-bottom:8px }
  .browser-bar input{ flex:1; padding:8px; border-radius:8px; border:1px solid var(--border); background:#0a1020; color:#fff }
  .browser iframe{ width:100%; height:calc(100% - 50px); border:0; background:#0a1020 }

  .calc{ display:grid; grid-template-columns:repeat(4,1fr); gap:8px }
  .calc input{ grid-column:1/-1; padding:10px; border-radius:8px; background:#0a1020; border:1px solid var(--border); color:#fff }
  .calc button{ padding:10px; border-radius:8px; border:0; background:rgba(255,255,255,.08); color:#fff; cursor:pointer }
  .calc button:hover{ background:rgba(255,255,255,.16) }

  .music audio{ width:100% }
  .paint canvas{ background:#0a1020; border:1px solid var(--border); border-radius:10px }
  .tasks-app li{ display:flex; align-items:center; gap:8px; margin:6px 0 }
</style>
</head>
<body>
<div class="desktop theme-0" id="desktop">
  <!-- Desktop icons -->
  <section class="icons" id="icons"></section>

  <!-- Start menu -->
  <div class="start" id="start">
    <div class="search"><input id="startSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ·Ø¨ÙŠÙ‚" /></div>
    <div class="apps" id="startApps"></div>
  </div>

  <!-- Taskbar -->
  <footer class="taskbar">
    <button class="start-btn" id="startBtn"><span class="start-dot"></span><span>Ø§Ø¨Ø¯Ø£</span></button>
    <div class="tasks" id="tasks"></div>
    <div class="sys">
      <span id="net">Wiâ€‘Fi</span>
      <span class="clock" id="clock">00:00</span>
    </div>
  </footer>

  <!-- Context menu -->
  <div class="ctx" id="ctx">
    <div class="item" data-cmd="new-note">Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
    <div class="item" data-cmd="new-window">Ù†Ø§ÙØ°Ø© ÙØ§Ø±ØºØ©</div>
    <div class="item" data-cmd="theme">ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ©</div>
    <div class="item" data-cmd="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>
</div>

<script>
/* =========================
   CONFIG â€” Apps catalog
   ========================= */
const APPS = [
  { id:'explorer', name:'Ø§Ù„Ù…Ø³ØªÙƒØ´Ù', glyph:'ğŸ“' },
  { id:'notepad',  name:'Ø§Ù„Ù…ÙÙƒØ±Ø©',  glyph:'ğŸ“' },
  { id:'browser',  name:'Ø§Ù„Ù…ØªØµÙØ­ (Pro)', glyph:'ğŸŒ' },
  { id:'terminal', name:'Ø§Ù„Ø·Ø±ÙÙŠØ©',  glyph:'>_' },
  { id:'settings', name:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', glyph:'âš™ï¸' },
  { id:'calculator', name:'Ø§Ù„Ø­Ø§Ø³Ø¨Ø©', glyph:'ğŸ§®' },
  { id:'music', name:'Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰', glyph:'ğŸµ' },
  { id:'gallery', name:'Ø§Ù„Ù…Ø¹Ø±Ø¶', glyph:'ğŸ–¼ï¸' },
  { id:'paint', name:'Ø§Ù„Ø±Ø³Ø§Ù…', glyph:'ğŸ¨' },
  { id:'todo', name:'Ø§Ù„Ù…Ù‡Ø§Ù…', glyph:'âœ…' },
  { id:'store', name:'Ù…ØªØ¬Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª', glyph:'ğŸ›ï¸' }
];

const DESKTOP_SHORTCUTS = [
  { id:'explorer' }, { id:'browser' }, { id:'notepad' }, { id:'calculator' }, { id:'gallery' }, { id:'music' }, { id:'paint' }, { id:'todo' }, { id:'settings' }, { id:'store' }
];

/* =========================
   STATE
   ========================= */
let zCounter = 10;
const windows = new Map(); // id -> dom
const tasks = new Map();   // id -> task button
let themeIndex = Number(localStorage.getItem('themeIndex') || 0);

/* =========================
   UTIL
   ========================= */
const desk = document.getElementById('desktop');
const iconsEl = document.getElementById('icons');
const startEl = document.getElementById('start');
const startBtn = document.getElementById('startBtn');
const startApps = document.getElementById('startApps');
const startSearch = document.getElementById('startSearch');
const tasksEl = document.getElementById('tasks');
const clockEl = document.getElementById('clock');
const ctxEl = document.getElementById('ctx');
const toastEl = document.getElementById('toast');

function clockTick(){
  const d=new Date(); const h=d.getHours().toString().padStart(2,'0'); const m=d.getMinutes().toString().padStart(2,'0');
  clockEl.textContent = `${h}:${m}`;
}
setInterval(clockTick, 1000); clockTick();

function toast(msg){
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  setTimeout(()=>toastEl.classList.remove('show'), 2500);
}

/* =========================
   DESKTOP & START MENU
   ========================= */
function buildDesktopShortcuts(){
  iconsEl.innerHTML='';
  DESKTOP_SHORTCUTS.forEach(s=>{
    const a = APPS.find(x=>x.id===s.id);
    const div = document.createElement('div');
    div.className='icon';
    div.dataset.app=a.id;
    div.innerHTML = `<div class="glyph">${a.glyph}</div><div class="label">${a.name}</div>`;
    div.addEventListener('dblclick', ()=>openApp(a.id));
    iconsEl.appendChild(div);
  });
}
function buildStartMenu(){
  startApps.innerHTML='';
  APPS.forEach(a=>{
    const row = document.createElement('div');
    row.className='app';
    row.dataset.app=a.id;
    row.innerHTML = `<span class="glyph" style="width:28px;height:28px;border-radius:6px;display:grid;place-items:center;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff">${a.glyph}</span><span>${a.name}</span>`;
    row.addEventListener('click', ()=>{ openApp(a.id); toggleStart(false); });
    startApps.appendChild(row);
  });
}
function toggleStart(show){
  startEl.classList.toggle('show', show ?? !startEl.classList.contains('show'));
}
startBtn.addEventListener('click', ()=>toggleStart());
desk.addEventListener('click', (e)=>{
  if (!startEl.contains(e.target) && !startBtn.contains(e.target)) toggleStart(false);
  if (!ctxEl.contains(e.target)) ctxEl.classList.remove('show');
});
startSearch.addEventListener('input', ()=>{
  const q = startSearch.value.trim();
  [...startApps.children].forEach(el=>{
    const name = el.textContent.toLowerCase();
    el.style.display = name.includes(q.toLowerCase())?'flex':'none';
  });
});

/* =========================
   WINDOWS & TASKS
   ========================= */
function openApp(id){
  const app = APPS.find(x=>x.id===id);
  if (!app) return;
  let win = windows.get(id);
  if (!win){
    win = createWindow(app);
    windows.set(id, win);
    const t = createTask(app);
    tasks.set(id, t);
  }
  focusWindow(win);
}
function createTask(app){
  const t = document.createElement('button');
  t.className='task';
  t.dataset.app=app.id;
  t.innerHTML = `<span>${app.name}</span><span>â– </span>`;
  t.onclick = ()=>openApp(app.id);
  tasksEl.appendChild(t);
  return t;
}
function focusWindow(win){
  document.querySelectorAll('.win').forEach(w=>w.classList.remove('active'));
  win.style.zIndex = ++zCounter;
  const task = tasks.get(win.dataset.app);
  document.querySelectorAll('.task').forEach(t=>t.classList.remove('active'));
  if (task) task.classList.add('active');
  win.classList.remove('hidden');
}
function createWindow(app){
  const w = document.createElement('div');
  w.className='win';
  w.dataset.app=app.id;
  w.style.top = (72 + Math.random()*60)+'px';
  w.style.left = (90 + Math.random()*120)+'px';

  const header = document.createElement('div');
  header.className='win-header';
  header.innerHTML = `<div class="win-title"><span style="width:22px;height:22px;border-radius:6px;display:grid;place-items:center;background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fff">${app.glyph}</span>${app.name}</div>
  <div class="win-actions">
    <button class="btn" data-act="min">ØªØµØºÙŠØ±</button>
    <button class="btn" data-act="max">ØªÙƒØ¨ÙŠØ±</button>
    <button class="btn" data-act="close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>`;
  const body = document.createElement('div'); body.className='win-body'; body.appendChild(renderApp(app.id));
  const res = document.createElement('div'); res.className='resize';

  w.appendChild(header); w.appendChild(body); w.appendChild(res);
  desk.appendChild(w);

  // drag
  let dx=0, dy=0, dragging=false;
  header.addEventListener('mousedown', e=>{ dragging=true; dx=e.clientX - w.offsetLeft; dy=e.clientY - w.offsetTop; });
  window.addEventListener('mousemove', e=>{ if(dragging){ w.style.left = (e.clientX - dx)+'px'; w.style.top = (e.clientY - dy)+'px'; } });
  window.addEventListener('mouseup', ()=>dragging=false);

  // resize
  let rs=false, sx=0, sy=0, sw=0, sh=0;
  res.addEventListener('mousedown', e=>{ rs=true; sx=e.clientX; sy=e.clientY; sw=w.offsetWidth; sh=w.offsetHeight; e.preventDefault(); });
  window.addEventListener('mousemove', e=>{ if(rs){ w.style.width = Math.max(420, sw + (e.clientX - sx))+'px'; w.style.height = Math.max(280, sh + (e.clientY - sy))+'px'; } });
  window.addEventListener('mouseup', ()=>rs=false);

  // actions
  header.querySelectorAll('.btn').forEach(b=>{
    b.addEventListener('click', ()=>{
      const act=b.dataset.act;
      if (act==='close'){ w.classList.add('hidden'); const t=tasks.get(app.id); if(t) t.remove(); tasks.delete(app.id); windows.delete(app.id); }
      if (act==='min'){ w.classList.add('hidden'); const t=tasks.get(app.id); if(t) t.classList.remove('active'); }
      if (act==='max'){ w.style.top='48px'; w.style.left='16px'; w.style.width='calc(100vw - 32px)'; w.style.height='calc(100vh - 110px)'; focusWindow(w); }
    });
  });

  // focus on click
  w.addEventListener('mousedown', ()=>focusWindow(w));
  return w;
}

/* =========================
   APPS RENDERERS
   ========================= */
function renderApp(id){
  if (id==='explorer'){
    const wrap = document.createElement('div'); wrap.className='grid2';
    const side = document.createElement('div'); side.className='side';
    side.innerHTML = `<div class="item" data-path="Desktop">Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨</div>
                      <div class="item" data-path="Documents">Ù…Ø³ØªÙ†Ø¯Ø§Øª</div>
                      <div class="item" data-path="Downloads">ØªÙ†Ø²ÙŠÙ„Ø§Øª</div>`;
    const main = document.createElement('div'); main.className='files';
    wrap.appendChild(side); wrap.appendChild(main);

    const filesDB = JSON.parse(localStorage.getItem('filesDB')||'{}');
    function list(path){
      main.innerHTML='';
      const items = filesDB[path] || sampleFiles(path);
      items.forEach(f=>{
        const div = document.createElement('div'); div.className='file';
        div.innerHTML = `<div style="font-weight:600">${f.name}</div><div style="font-size:12px;color:var(--muted)">${f.type} â€¢ ${f.size}</div>`;
        div.addEventListener('dblclick', ()=>{
          if (f.app) openApp(f.app);
        });
        main.appendChild(div);
      });
    }
    function sampleFiles(path){
      const samples={
        Desktop:[{name:'Ù…ÙÙƒØ±Ø©.txt',type:'Text',size:'2 KB',app:'notepad'},{name:'ØªØ¹Ù„ÙŠÙ…Ø§Øª.html',type:'HTML',size:'4 KB',app:'browser'}],
        Documents:[{name:'Ù…Ø´Ø±ÙˆØ¹.md',type:'Markdown',size:'3 KB',app:'notepad'}],
        Downloads:[{name:'index.html',type:'HTML',size:'6 KB',app:'browser'}]
      }; return samples[path]||[];
    }
    side.querySelectorAll('.item').forEach(el=>el.addEventListener('click', ()=>list(el.dataset.path)));
    list('Desktop');
    return wrap;
  }

  if (id==='notepad'){
    const wrap = document.createElement('div'); wrap.className='editor';
    wrap.innerHTML = `<div style="display:flex;gap:8px;margin-bottom:8px">
      <button class="btn" id="noteSave">Ø­ÙØ¸</button>
      <button class="btn" id="noteLoad">ØªØ­Ù…ÙŠÙ„</button>
      <button class="btn" id="noteNew">Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <textarea id="noteArea" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..."></textarea>`;
    const area = wrap.querySelector('#noteArea');
    wrap.querySelector('#noteSave').onclick = ()=>{ localStorage.setItem('notepad', area.value); toast('ØªÙ… Ø§Ù„Ø­ÙØ¸'); };
    wrap.querySelector('#noteLoad').onclick = ()=>{ area.value = localStorage.getItem('notepad')||''; toast('ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„'); };
    wrap.querySelector('#noteNew').onclick = ()=>{ area.value=''; };
    return wrap;
  }

  if (id==='browser'){
    const wrap = document.createElement('div'); wrap.className='browser';
    wrap.innerHTML = `<div class="browser-bar">
      <select id="mode">
        <option value="external">ÙØªØ­ ÙƒØ§Ù…Ù„ (ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯)</option>
        <option value="embed">ØªØ¶Ù…ÙŠÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø©</option>
      </select>
      <input id="url" placeholder="https://www.google.com" value="https://www.google.com">
      <button class="btn" id="go">Ø§Ø°Ù‡Ø¨</button>
    </div>
    <iframe id="frame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
    <div style="margin-top:8px;color:var(--muted)">
      Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ù…Ù†ÙŠØ© (Ù…Ø«Ù„ Google) Ù‚Ø¯ ØªÙ…Ù†Ø¹ Ø§Ù„ØªØ¶Ù…ÙŠÙ† Ø¯Ø§Ø®Ù„ iframe. ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ "ÙØªØ­ ÙƒØ§Ù…Ù„".
    </div>`;
    const mode = wrap.querySelector('#mode');
    const url = wrap.querySelector('#url');
    const frame = wrap.querySelector('#frame');
    function navigate(){
      const u = url.value.trim();
      if (!u) return;
      const full = u.startsWith('http') ? u : ('https://' + u);
      if (mode.value === 'external'){
        window.open(full, '_blank', 'noopener,noreferrer');
        toast('ØªÙ… ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯');
      } else {
        frame.src = full;
      }
    }
    wrap.querySelector('#go').onclick = navigate;
    url.addEventListener('keydown', e=>{ if(e.key==='Enter') navigate(); });
    return wrap;
  }

  if (id==='terminal'){
    const wrap = document.createElement('div'); wrap.className='terminal';
    wrap.innerHTML = `<div>Terminal â€” Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ù‹Ø§ Ø«Ù… Enter</div>
      <div id="out" style="margin:8px 0;white-space:pre-wrap"></div>
      <div><span class="prompt">C:\\></span> <input id="cmd" style="width:80%;background:#0a1020;border:1px solid var(--border);color:#fff;padding:6px;border-radius:8px"></div>`;
    const out = wrap.querySelector('#out'); const cmd = wrap.querySelector('#cmd');
    const cmds = {
      help: ()=>"Ø§Ù„Ø£ÙˆØ§Ù…Ø±: help, echo <text>, date, ls, clear, theme <0|1|2>, about",
      echo: (args)=>args.join(' '),
      date: ()=>new Date().toString(),
      ls: ()=>"Desktop Documents Downloads",
      clear: ()=>{ out.textContent=''; return ''; },
      theme: (args)=>{ const n=Number(args[0]||0); setTheme(n); return 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¥Ù„Ù‰ '+n; },
      about: ()=>"Windows Pro Web Simulator â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯ØŒ PWAØŒ Ù…ØªØµÙØ­ Ø¨ÙˆØ¶Ø¹ÙŠÙ†ØŒ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©."
    };
    cmd.addEventListener('keydown', e=>{
      if (e.key==='Enter'){
        const parts = cmd.value.trim().split(/\s+/); const name=parts.shift().toLowerCase();
        const fn = cmds[name]; let res='';
        if (fn) res = fn(parts)||'';
        else res = 'Ø£Ù…Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: '+name;
        out.textContent += `\n$ ${cmd.value}\n${res}`;
        cmd.value='';
      }
    });
    return wrap;
  }

  if (id==='settings'){
    const wrap = document.createElement('div'); wrap.style.padding='6px';
    wrap.innerHTML = `<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
      <div class="file"><div style="font-weight:600">Ø§Ù„Ø³ÙÙ…Ø©</div>
        <div style="margin-top:6px;display:flex;gap:8px">
          <button class="btn" data-theme="0">Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
          <button class="btn" data-theme="1">Ø£Ø®Ø¶Ø±</button>
          <button class="btn" data-theme="2">Ø¨Ù†ÙØ³Ø¬ÙŠ</button>
        </div>
      </div>
      <div class="file"><div style="font-weight:600">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
        <div style="margin-top:6px"><button class="btn" id="notify">Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±</button></div>
      </div>
      <div class="file"><div style="font-weight:600">Ø­ÙˆÙ„</div>
        <div style="margin-top:6px;color:var(--muted)">Windows Pro Web Simulator â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯ØŒ PWAØŒ Ù…ØªØµÙØ­ Ø¨ÙˆØ¶Ø¹ÙŠÙ†ØŒ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©.</div>
      </div>
    </div>`;
    wrap.querySelectorAll('[data-theme]').forEach(b=>{
      b.onclick = ()=> setTheme(Number(b.dataset.theme));
    });
    wrap.querySelector('#notify').onclick = ()=>toast('Ù‡Ø°Ø§ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ ğŸ‰');
    return wrap;
  }

  if (id==='calculator'){
    const wrap = document.createElement('div'); wrap.className='calc';
    wrap.innerHTML = `<input id="calcIn" placeholder="3+4*2">
      ${['7','8','9','/','4','5','6','*','1','2','3','-','0','.','=','+'].map(k=>`<button>${k}</button>`).join('')}
      <div id="calcOut" style="grid-column:1/-1;color:var(--muted)"></div>`;
    const out = wrap.querySelector('#calcOut'); const input = wrap.querySelector('#calcIn');
    wrap.querySelectorAll('button').forEach(b=>{
      b.onclick = ()=>{
        const k=b.textContent;
        if(k==='='){ try{ out.textContent = 'Ø§Ù„Ù†ØªÙŠØ¬Ø©: ' + Function('return '+input.value)(); } catch{ out.textContent='ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©'; } }
        else input.value += k;
      };
    });
    return wrap;
  }

  if (id==='music'){
    const wrap = document.createElement('div'); wrap.className='music';
    wrap.innerHTML = `<div style="margin-bottom:8px">Ù…Ø´ØºÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¨Ø³ÙŠØ· (Ø¶Ø¹ Ù…Ù„ÙÙƒ Ø¹Ø¨Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù†):</div>
      <input id="src" placeholder="https://example.com/track.mp3" style="width:100%;padding:8px;border-radius:8px;background:#0a1020;border:1px solid var(--border);color:#fff">
      <audio id="player" controls></audio>`;
    const src = wrap.querySelector('#src'); const player = wrap.querySelector('#player');
    src.addEventListener('keydown', e=>{ if(e.key==='Enter'){ player.src = src.value.trim(); player.play().catch(()=>{}); } });
    return wrap;
  }

  if (id==='gallery'){
    const wrap = document.createElement('div'); wrap.className='files';
    const imgs = JSON.parse(localStorage.getItem('gallery')||'[]');
    function render(){
      wrap.innerHTML='';
      imgs.forEach((u,i)=>{
        const card = document.createElement('div'); card.className='file';
        card.innerHTML = `<img src="${u}" style="width:100%;height:160px;object-fit:cover;border-radius:8px"><div style="margin-top:6px;font-size:12px;color:var(--muted)">ØµÙˆØ±Ø© ${i+1}</div>`;
        wrap.appendChild(card);
      });
      const add = document.createElement('div'); add.className='file';
      add.innerHTML = `<div style="display:flex;gap:8px;align-items:center">
        <input id="imgUrl" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©..." style="flex:1;padding:8px;border-radius:8px;background:#0a1020;border:1px solid var(--border);color:#fff">
        <button class="btn" id="addImg">Ø¥Ø¶Ø§ÙØ©</button>
      </div>`;
      add.querySelector('#addImg').onclick = ()=>{
        const u = add.querySelector('#imgUrl').value.trim();
        if(u){ imgs.push(u); localStorage.setItem('gallery', JSON.stringify(imgs)); render(); toast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©'); }
      };
      wrap.appendChild(add);
    }
    render();
    return wrap;
  }

  if (id==='paint'){
    const wrap = document.createElement('div'); wrap.className='paint';
    wrap.innerHTML = `<div style="margin-bottom:8px;display:flex;gap:8px">
      <label>Ø§Ù„Ø­Ø¬Ù… <input id="size" type="range" min="2" max="24" value="6"></label>
      <input id="color" type="color" value="#22c55e">
      <button class="btn" id="clear">Ù…Ø³Ø­</button>
    </div>
    <canvas id="c" width="800" height="380"></canvas>`;
    const c = wrap.querySelector('#c'); const ctx = c.getContext('2d');
    let drawing=false, size=6, color='#22c55e';
    c.addEventListener('mousedown', e=>{ drawing=true; draw(e); });
    c.addEventListener('mousemove', e=>{ if(drawing) draw(e); });
    window.addEventListener('mouseup', ()=>drawing=false);
    function draw(e){ const rect=c.getBoundingClientRect(); const x=e.clientX-rect.left; const y=e.clientY-rect.top; ctx.fillStyle=color; ctx.beginPath(); ctx.arc(x,y,size,0,Math.PI*2); ctx.fill(); }
    wrap.querySelector('#size').oninput = e=> size=Number(e.target.value);
    wrap.querySelector('#color').oninput = e=> color=e.target.value;
    wrap.querySelector('#clear').onclick = ()=> ctx.clearRect(0,0,c.width,c.height);
    return wrap;
  }

  if (id==='todo'){
    const wrap = document.createElement('div');
    wrap.innerHTML = `<div style="display:flex;gap:8px;margin-bottom:8px">
      <input id="taskIn" placeholder="Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©" style="flex:1;padding:8px;border-radius:8px;background:#0a1020;border:1px solid var(--border);color:#fff">
      <button class="btn" id="add">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <ul id="list" class="tasks-app" style="list-style:none;padding:0;margin:0"></ul>`;
    const list = wrap.querySelector('#list');
    const tasksDB = JSON.parse(localStorage.getItem('tasksDB')||'[]');
    function render(){
      list.innerHTML='';
      tasksDB.forEach((t,i)=>{
        const li = document.createElement('li');
        li.innerHTML = `<input type="checkbox" ${t.done?'checked':''}> <span>${t.text}</span> <button class="btn" data-i="${i}">Ø­Ø°Ù</button>`;
        li.querySelector('input').onchange = e=>{ t.done = e.target.checked; save(); render(); };
        li.querySelector('button').onclick = e=>{ tasksDB.splice(Number(e.target.dataset.i),1); save(); render(); };
        list.appendChild(li);
      });
    }
    function save(){ localStorage.setItem('tasksDB', JSON.stringify(tasksDB)); }
    wrap.querySelector('#add').onclick = ()=>{
      const val = wrap.querySelector('#taskIn').value.trim(); if(!val) return;
      tasksDB.push({text:val, done:false}); save(); render(); wrap.querySelector('#taskIn').value='';
    };
    render();
    return wrap;
  }

  if (id==='store'){
    const wrap = document.createElement('div');
    wrap.innerHTML = `<div style="margin-bottom:8px;color:var(--muted)">Ù…ØªØ¬Ø± ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆÙ‡Ù…ÙŠ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ«Ø¨ÙŠØª Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨.</div>
      <div class="files" id="appsGrid"></div>`;
    const appsGrid = wrap.querySelector('#appsGrid');
    const catalog = [
      {id:'notes2', name:'Ù…ÙÙƒØ±Ø© Ù…ØªÙ‚Ø¯Ù…Ø©', glyph:'ğŸ—’ï¸', install:()=>toast('ØªØ«Ø¨ÙŠØª ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ø³ØªØ®Ø¯Ù…Ù‘ Ø§Ù„Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©')},
      {id:'player', name:'Ù…Ø´ØºÙ„ ÙÙŠØ¯ÙŠÙˆ', glyph:'ğŸ“º', install:()=>toast('Ø´ØºÙ‘Ù„ ÙÙŠØ¯ÙŠÙˆ Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰')},
      {id:'camera', name:'ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙŠØ¨', glyph:'ğŸ“·', install:()=>toast('ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© getUserMedia Ù„Ø§Ø­Ù‚Ù‹Ø§')}
    ];
    catalog.forEach(app=>{
      const card = document.createElement('div'); card.className='file';
      card.innerHTML = `<div style="font-weight:600">${app.name}</div><div style="font-size:12px;color:var(--muted)">${app.glyph}</div>
        <div style="margin-top:8px"><button class="btn">ØªØ«Ø¨ÙŠØª</button></div>`;
      card.querySelector('.btn').onclick = ()=>{
        app.install();
      };
      appsGrid.appendChild(card);
    });
    return wrap;
  }

  // fallback
  const div = document.createElement('div'); div.textContent='ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'; return div;
}

/* =========================
   CONTEXT MENU & THEMES
   ========================= */
desk.addEventListener('contextmenu', e=>{
  e.preventDefault();
  ctxEl.style.left = e.clientX+'px';
  ctxEl.style.top  = e.clientY+'px';
  ctxEl.classList.add('show');
});
ctxEl.addEventListener('click', e=>{
  const cmd = e.target.dataset.cmd;
  ctxEl.classList.remove('show');
  if (cmd==='new-note') openApp('notepad');
  if (cmd==='new-window'){
    const tmpId='blank-'+Math.random().toString(36).slice(2);
    APPS.push({id:tmpId,name:'Ù†Ø§ÙØ°Ø©',glyph:'ğŸªŸ'}); openApp(tmpId);
  }
  if (cmd==='theme') setTheme((themeIndex+1)%3);
  if (cmd==='settings') openApp('settings');
});
function setTheme(i){
  themeIndex = i;
  desk.className = 'desktop theme-'+i;
  localStorage.setItem('themeIndex', i);
}

/* =========================
   INIT
   ========================= */
buildDesktopShortcuts();
buildStartMenu();
setTheme(themeIndex);

/* =========================
   PWA â€” Manifest & Service Worker (inline)
   ========================= */
const manifest = {
  name: "Windows Pro Web Simulator",
  short_name: "WinPro",
  start_url: "./index.html",
  display: "standalone",
  background_color: "#0b1220",
  theme_color: "#2563eb",
  icons: [{
    src: "data:image/svg+xml;base64,"+btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 256 256\"><rect width=\"256\" height=\"256\" rx=\"48\" fill=\"#2563eb\"/><g fill=\"#fff\"><rect x=\"24\" y=\"24\" width=\"104\" height=\"104\"/><rect x=\"136\" y=\"24\" width=\"96\" height=\"104\"/><rect x=\"24\" y=\"136\" width=\"104\" height=\"96\"/><rect x=\"136\" y=\"136\" width=\"96\" height=\"96\"/></g></svg>'),
    sizes: "256x256",
    type: "image/svg+xml",
    purpose: "any maskable"
  }]
};
const manifestURL = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'}));
const linkManifest = document.createElement('link'); linkManifest.rel='manifest'; linkManifest.href=manifestURL; document.head.appendChild(linkManifest);

const swCode = `
  const CACHE='winsim-pro-v1';
  const ASSETS=['./','./index.html'];
  self.addEventListener('install',e=>{
    e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting()));
  });
  self.addEventListener('activate',e=>{
    e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k!==CACHE&&caches.delete(k)))));
    self.clients.claim();
  });
  self.addEventListener('fetch',e=>{
    if(e.request.method!=='GET') return;
    const url = new URL(e.request.url);
    e.respondWith(
      caches.match(e.request).then(res=>res||fetch(e.request).then(net=>{
        if(url.origin===self.location.origin){
          const clone=net.clone(); caches.open(CACHE).then(c=>c.put(e.request, clone));
        }
        return net;
      }).catch(()=>caches.match('./index.html')))
    );
  });
`;
const swURL = URL.createObjectURL(new Blob([swCode], {type:'application/javascript'}));
if ('serviceWorker' in navigator){ navigator.serviceWorker.register(swURL); }
</script>
</body>
</html>
